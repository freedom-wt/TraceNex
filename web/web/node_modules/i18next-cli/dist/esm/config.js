import{resolve as r,join as t,dirname as o}from"node:path";import{pathToFileURL as n}from"node:url";import{access as e,readFile as i}from"node:fs/promises";import{createJiti as a}from"jiti";import{parse as c}from"jsonc-parser";import s from"inquirer";import f from"chalk";import{runInit as l}from"./init.js";import{ConsoleLogger as u}from"./utils/logger.js";const p=["i18next.config.ts","i18next.config.js","i18next.config.mjs","i18next.config.cjs"];function m(r){return r}async function d(t,o=new u){const i=await async function(t){if(t){const o=r(process.cwd(),t);try{return await e(o),o}catch{return null}}for(const t of p){const o=r(process.cwd(),t);try{return await e(o),o}catch{}}return null}(t);if(!i)return t&&o.error(`Error: Config file not found at "${t}"`),null;try{let r;if(i.endsWith(".ts")){const t=await w(),o=a(process.cwd(),{alias:t,interopDefault:!1}),n=await o.import(i,{default:!0});r=n}else{const t=n(i).href,o=await import(`${t}?t=${Date.now()}`);r=o.default}return r?(r.extract||={},r.extract.primaryLanguage||=r.locales[0]||"en",r.extract.secondaryLanguages||=r.locales.filter(t=>t!==r.extract.primaryLanguage),r):(o.error(`Error: No default export found in ${i}`),null)}catch(r){return o.error(`Error loading configuration from ${i}`),o.error(r),null}}async function g(r,t=new u){let o=await d(r,t);if(o)return o;const{shouldInit:n}=await s.prompt([{type:"confirm",name:"shouldInit",message:f.yellow("Configuration file not found. Would you like to create one now?"),default:!0}]);if(n){if(await l(),t.info(f.green("Configuration created. Resuming command...")),o=await d(r,t),o)return o;t.error(f.red("Error: Failed to load configuration after creation. Please try running the command again.")),process.exit(1)}else t.info("Operation cancelled. Please create a configuration file to proceed."),process.exit(0)}async function w(){try{const n=await async function(){let r=process.cwd();for(;;){const n=t(r,"tsconfig.json");try{return await e(n),n}catch{const t=o(r);if(t===r)return null;r=t}}}();if(!n)return{};const a=await i(n,"utf-8"),s=c(a),f=s.compilerOptions?.paths,l=s.compilerOptions?.baseUrl||".";if(!f)return{};const u={};for(const[t,o]of Object.entries(f))if(Array.isArray(o)&&o.length>0){const n=t.replace("/*",""),e=r(process.cwd(),l,o[0].replace("/*",""));u[n]=e}return u}catch(r){return{}}}export{m as defineConfig,g as ensureConfig,w as getTsConfigAliases,d as loadConfig};
