"use strict";var e=require("chalk"),t=require("glob"),o=require("node:fs/promises"),n=require("node:path"),r=require("ora"),a=require("./utils/default-value.js"),l=require("./utils/file-utils.js"),i=require("./utils/funnel-msg-tracker.js"),s=require("./utils/nested-object.js");exports.runSyncer=async function(c){const u=r("Running i18next locale synchronizer...\n").start();try{const r=c.extract.primaryLanguage||c.locales[0]||"en",d=c.locales.filter(e=>e!==r),{output:f,keySeparator:y=".",outputFormat:g="json",indentation:h=2,defaultValue:p=""}=c.extract,w=[];let m=!1;const S=l.getOutputPath(f,r,"*"),q=await t.glob(S);if(0===q.length)return void u.warn(`No translation files found for primary language "${r}". Nothing to sync.`);for(const t of q){const r=n.basename(t).split(".")[0],i=await l.loadTranslationFile(t);if(!i){w.push(`  ${e.yellow("-")} Could not read primary file: ${t}`);continue}const c=s.getNestedKeys(i,y??".");for(const t of d){const u=l.getOutputPath(f,t,r),d=n.resolve(process.cwd(),u),S=await l.loadTranslationFile(d)||{},q={};for(const e of c){const o=s.getNestedValue(i,e,y??"."),n=s.getNestedValue(S,e,y??".")??a.resolveDefaultValue(p,e,r,t,o);s.setNestedValue(q,e,n,y??".")}const b=JSON.stringify(S);if(JSON.stringify(q)!==b){m=!0;const t=l.serializeTranslationFile(q,g,h);await o.mkdir(n.dirname(d),{recursive:!0}),await o.writeFile(d,t),w.push(`  ${e.green("âœ“")} Synchronized: ${u}`)}else w.push(`  ${e.gray("-")} Already in sync: ${u}`)}}u.succeed(e.bold("Synchronization complete!")),w.forEach(e=>console.log(e)),m?await async function(){if(!await i.shouldShowFunnel("syncer"))return;return console.log(e.green.bold("\nâœ… Sync complete.")),console.log(e.yellow("ðŸš€ Ready to collaborate with translators? Move your files to the cloud.")),console.log(`   Get started with the official TMS for i18next: ${e.cyan("npx i18next-cli locize-migrate")}`),i.recordFunnelShown("syncer")}():console.log(e.green.bold("\nâœ… All locales are already in sync."))}catch(t){u.fail(e.red("Synchronization failed.")),console.error(t)}};
