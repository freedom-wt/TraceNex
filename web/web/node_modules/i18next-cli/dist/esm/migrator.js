import{resolve as e}from"node:path";import{access as t,writeFile as o}from"node:fs/promises";import{pathToFileURL as n}from"node:url";import{createJiti as i}from"jiti";import{getTsConfigAliases as r}from"./config.js";const s=e(process.cwd(),"i18next.config.ts"),a=["i18next.config.ts","i18next.config.js","i18next.config.mjs","i18next.config.cjs"],c=[".js",".mjs",".cjs",".ts"];async function l(e){if(c.some(t=>e.endsWith(t)))try{return await t(e),e}catch{return null}for(const o of c){const n=`${e}${o}`;try{return await t(n),n}catch{}}return null}async function f(c){let f;if(c){if(f=await l(e(process.cwd(),c)),!f)return console.log(`No legacy config file found at or near: ${c}`),void console.log("Tried extensions: .js, .mjs, .cjs, .ts")}else if(f=await l(e(process.cwd(),"i18next-parser.config")),!f)return console.log("No i18next-parser.config.* found. Nothing to migrate."),void console.log("Tried: i18next-parser.config.js, .mjs, .cjs, .ts");console.log(`Attempting to migrate legacy config from: ${f}...`);for(const o of a)try{const n=e(process.cwd(),o);return await t(n),void console.warn(`Warning: A new configuration file already exists at "${o}". Migration skipped to avoid overwriting.`)}catch(e){}const p=await async function(e){try{let t;if(e.endsWith(".ts")){const o=await r(),n=i(process.cwd(),{alias:o,interopDefault:!1});t=await n.import(e,{default:!0})}else{const o=n(e).href;t=(await import(`${o}?t=${Date.now()}`)).default}return t}catch(t){return console.error(`Error loading legacy config from ${e}:`,t),null}}(f);if(!p)return void console.error("Could not read the legacy config file.");const u={locales:p.locales||["en"],extract:{input:p.input||"src/**/*.{js,jsx,ts,tsx}",output:(p.output||"locales/$LOCALE/$NAMESPACE.json").replace("$LOCALE","{{language}}").replace("$NAMESPACE","{{namespace}}"),defaultNS:p.defaultNamespace||"translation",keySeparator:p.keySeparator,nsSeparator:p.namespaceSeparator,contextSeparator:p.contextSeparator,functions:p.lexers?.js?.functions||["t","*.t"],transComponents:p.lexers?.js?.components||["Trans"]},types:{input:["locales/{{language}}/{{namespace}}.json"],output:"src/types/i18next.d.ts"}};u.extract.functions.includes("t")&&!u.extract.functions.includes("*.t")&&u.extract.functions.push("*.t");const d=`\nimport { defineConfig } from 'i18next-cli';\n\nexport default defineConfig(${JSON.stringify(u,null,2)});\n`;await o(s,d.trim()),console.log("âœ… Success! Migration complete."),console.log(`New configuration file created at: ${s}`),console.warn('\nPlease review the generated file and adjust paths for "types.input" if necessary.'),p.keepRemoved&&console.warn('Warning: The "keepRemoved" option is deprecated. Consider using the "preservePatterns" feature for dynamic keys.'),"v3"===p.i18nextOptions?.compatibilityJSON&&console.warn('Warning: compatibilityJSON "v3" is not supported in i18next-cli. Only i18next v4 format is supported.')}export{f as runMigrator};
