"use strict";var e=require("node:path"),t=require("node:fs/promises"),n=require("node:url"),o=require("jiti"),s=require("./config.js");const r=e.resolve(process.cwd(),"i18next.config.ts"),i=["i18next.config.ts","i18next.config.js","i18next.config.mjs","i18next.config.cjs"],a=[".js",".mjs",".cjs",".ts"];async function c(e){if(a.some(t=>e.endsWith(t)))try{return await t.access(e),e}catch{return null}for(const n of a){const o=`${e}${n}`;try{return await t.access(o),o}catch{}}return null}exports.runMigrator=async function(a){let l;if(a){if(l=await c(e.resolve(process.cwd(),a)),!l)return console.log(`No legacy config file found at or near: ${a}`),void console.log("Tried extensions: .js, .mjs, .cjs, .ts")}else if(l=await c(e.resolve(process.cwd(),"i18next-parser.config")),!l)return console.log("No i18next-parser.config.* found. Nothing to migrate."),void console.log("Tried: i18next-parser.config.js, .mjs, .cjs, .ts");console.log(`Attempting to migrate legacy config from: ${l}...`);for(const n of i)try{const o=e.resolve(process.cwd(),n);return await t.access(o),void console.warn(`Warning: A new configuration file already exists at "${n}". Migration skipped to avoid overwriting.`)}catch(e){}const f=await async function(e){try{let t;if(e.endsWith(".ts")){const n=await s.getTsConfigAliases(),r=o.createJiti(process.cwd(),{alias:n,interopDefault:!1});t=await r.import(e,{default:!0})}else{const o=n.pathToFileURL(e).href;t=(await import(`${o}?t=${Date.now()}`)).default}return t}catch(t){return console.error(`Error loading legacy config from ${e}:`,t),null}}(l);if(!f)return void console.error("Could not read the legacy config file.");const u={locales:f.locales||["en"],extract:{input:f.input||"src/**/*.{js,jsx,ts,tsx}",output:(f.output||"locales/$LOCALE/$NAMESPACE.json").replace("$LOCALE","{{language}}").replace("$NAMESPACE","{{namespace}}"),defaultNS:f.defaultNamespace||"translation",keySeparator:f.keySeparator,nsSeparator:f.namespaceSeparator,contextSeparator:f.contextSeparator,functions:f.lexers?.js?.functions||["t","*.t"],transComponents:f.lexers?.js?.components||["Trans"]},types:{input:["locales/{{language}}/{{namespace}}.json"],output:"src/types/i18next.d.ts"}};u.extract.functions.includes("t")&&!u.extract.functions.includes("*.t")&&u.extract.functions.push("*.t");const p=`\nimport { defineConfig } from 'i18next-cli';\n\nexport default defineConfig(${JSON.stringify(u,null,2)});\n`;await t.writeFile(r,p.trim()),console.log("âœ… Success! Migration complete."),console.log(`New configuration file created at: ${r}`),console.warn('\nPlease review the generated file and adjust paths for "types.input" if necessary.'),f.keepRemoved&&console.warn('Warning: The "keepRemoved" option is deprecated. Consider using the "preservePatterns" feature for dynamic keys.'),"v3"===f.i18nextOptions?.compatibilityJSON&&console.warn('Warning: compatibilityJSON "v3" is not supported in i18next-cli. Only i18next v4 format is supported.')};
